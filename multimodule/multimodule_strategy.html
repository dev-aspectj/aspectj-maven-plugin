<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src\site\asciidoc/multimodule\multimodule_strategy.adoc at 2024-02-11
 | Rendered using Apache Maven Fluido Skin 1.11.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <meta name="date" content="2024-02-11 13:27:02 +0700" />
    <title>AspectJ Maven Plugin &#x2013; AspectJ in a multi-module reactor</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.11.1.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.11.1.min.js"></script>
    <style>.github-fork-ribbon:before { background-color: gray; }</style>
  </head>
  <body class="topBarDisabled">
    <a class="github-fork-ribbon right-top" href="https://github.com/dev-aspectj/aspectj-maven-plugin" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1>AspectJ Maven Plugin</h1>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
      <li class=""><a href=".././index.html" title="AspectJ Maven Plugin">AspectJ Maven Plugin</a><span class="divider">/</span></li>
    <li class="active ">AspectJ in a multi-module reactor <a href="https://github.com/dev-aspectj/aspectj-maven-plugin/src\site\asciidoc/multimodule\multimodule_strategy.adoc"><img src="../images/accessories-text-editor.png" title="Edit" /></a></li>
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2024-02-11</li>
          <li id="projectVersion" class="pull-right"><span class="divider">|</span>Version: 1.14</li>
        <li class="pull-right"><span class="divider">|</span>
<a href="https://www.eclipse.org/aspectj/doc/released/devguide/ajc-ref.html" class="externalLink" title="AJC Documentation">AJC Documentation</a></li>
        <li class="pull-right"><span class="divider">|</span>
<a href="https://www.eclipse.org/aspectj/" class="externalLink" title="AspectJ">AspectJ</a></li>
        <li class="pull-right"><a href="https://maven.apache.org/" class="externalLink" title="Maven">Maven</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href=".././index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href=".././usage.html" title="Usage"><span class="none"></span>Usage</a></li>
    <li><a href=".././plugin-info.html" title="Goals"><span class="none"></span>Goals</a></li>
   <li class="nav-header">Examples: Single-project AspectJ use</li>
    <li><a href=".././examples/differentTestAndCompile.html" title="Separate test/compile settings"><span class="none"></span>Separate test/compile settings</a></li>
    <li><a href=".././examples/includeExclude.html" title="Using includes/excludes"><span class="none"></span>Using includes/excludes</a></li>
    <li><a href=".././examples/usingTogetherWithAJDT.html" title="Using with AJDT"><span class="none"></span>Using with AJDT</a></li>
    <li><a href=".././examples/weaveJars.html" title="Weaving classes in jars"><span class="none"></span>Weaving classes in jars</a></li>
    <li><a href=".././examples/weaveDirectories.html" title="Weaving classes in directories"><span class="none"></span>Weaving classes in directories</a></li>
    <li><a href=".././examples/libraryJars.html" title="Using aspect libraries"><span class="none"></span>Using aspect libraries</a></li>
    <li><a href=".././examples/usingReport.html" title="Configuring report"><span class="none"></span>Configuring report</a></li>
   <li class="nav-header">Examples: Multi-module AspectJ use</li>
    <li><a href=".././multimodule/multimodule_strategy.html" title="Multi-module use of AspectJ"><span class="none"></span>Multi-module use of AspectJ</a></li>
   <li class="nav-header">AspectJ Compiler reference</li>
    <li><a href=".././ajc_reference/standard_opts.html" title="AJC standard options"><span class="none"></span>AJC standard options</a></li>
    <li><a href=".././ajc_reference/experimental_opts.html" title="AJC experimental options"><span class="none"></span>AJC experimental options</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<h1>AspectJ in a multi-module reactor</h1>
<div class="sect1">
<h2 id="strategies_for_using_aspectj_in_a_maven_multi_module_reactor">Strategies for using AspectJ in a Maven multi-module reactor</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a multi-module reactor, a convenient pattern for using AspectJ is to create one project containing Aspect definitions
to be used by ("woven into") the code of other projects within the Maven reactor. Since some dependencies (such as the
AspectJ runtime) must be identical in all the projects within the Maven reactor, this walk-through serves as a
step-by-step guide to painless use of aspects in a multi-module reactor.</p>
</div>
<div class="paragraph">
<p>To make this walk-through less abstract, we will use validation as an example throughout the step-by-step guide. In this
example, we will create a small API for validating the internal state of objects, and delegate its correct use to
AspectJ by means of the AspectJ Maven Plugin. There are many ways besides AspectJ to implement this, but AspectJ is one
of the few which does not depend on particular surroundings such as containers or application servers. In fact, the
small validation solution may be run directly in a plain Java SE environment. All steps will be detailed in the
walk-through below, but we will start by taking a look at the end result:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/multimodule_ajc.png" alt="multimodule ajc" width="482" height="291"/>
</div>
</div>
<div class="paragraph">
<p>The reactor contains the following parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rootParentPOM</code>: Contains version definitions for the <code>aspectjrt</code> and <code>aspectjtools</code> libraries, to be used in all
modules in the multi-module reactor.</p>
</li>
<li>
<p><code>validation-api</code>: Defines a small API for validating the internal state of objects.</p>
</li>
<li>
<p><code>validation-aspect</code>: Defines an aspect using classes from the <code>validation-api</code> to validate the internal state of
objects.</p>
</li>
<li>
<p><code>aspectParentPOM</code>: Configures the AspectJ Maven Plugin (this plugin!) to use the aspect defined within the
<code>validation-aspect</code> module and apply it on all Maven modules using <code>aspectParentPOM</code> as a parent POM.</p>
</li>
<li>
<p><code>mavenProjectWithAspects</code>: A project whose classes can use/implement types from the <code>validation-api</code> to indicate
that the aspect defined in <code>validation-aspect</code> should be woven into its bytecode representation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After the introduction, let us proceed to the step-by-step guide.</p>
</div>
<div class="sect2">
<h3 id="define_required_runtime_dependency_versions">Define required runtime dependency versions</h3>
<div class="paragraph">
<p>In the <code>rootParentPom</code>, define dependencies for the AspectJ runtime and your aspect library. It is recommended to
introduce a Maven property in order to reduce the number of locations where the AspectJ version must be changed to
upgrade the dependency.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="c">&lt;!-- +========================================= --&gt;</span>
<span class="c">&lt;!-- | Maven property definitions               --&gt;</span>
<span class="c">&lt;!-- +========================================= --&gt;</span>
<span class="nt">&lt;properties&gt;</span>
  <span class="nt">&lt;aspectj.version&gt;</span>1.9.21<span class="nt">&lt;/aspectj.version&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/properties&gt;</span>

<span class="c">&lt;!-- +========================================= --&gt;</span>
<span class="c">&lt;!-- | Dependency (management) settings         --&gt;</span>
<span class="c">&lt;!-- +========================================= --&gt;</span>
<span class="nt">&lt;dependencyManagement&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="c">&lt;!-- AOP dependencies. --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>aspectjrt<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${aspectj.version}<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>aspectjtools<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${aspectj.version}<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/dependencyManagement&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The definitions in the <code>rootParentPOM</code> are now complete.</p>
</div>
</div>
<div class="sect2">
<h3 id="implement_the_validation_api">Implement the validation API</h3>
<div class="paragraph">
<p>For the purpose of this example, we would like AspectJ to enforce a common behaviour/lifecycle for objects whose
internal state can be validated. The validation API contains a defining interface <code>Validatable</code>, to be implemented by
any class whose instances should be validated after creation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="cm">/**
 * Specification for providing an object with validation mechanics.
 * Each Validatable object can perform internal validation to assert
 * its state before being serialized and after being deserialized.
 *
 * Making an object implement Validatable does not imply that all
 * uses of the object is guaranteed. Validatable objects should
 * primarily make use of their own data to ascertain its valid state.
 *
 * It is the responsibilities of services using the Validatable object
 * (as opposed to the validation mechanics provided within this Validatable)
 * to provide extra/semantic validation for object &lt;strong&gt;graphs&lt;/strong&gt;
 * in which this Validatable instance is part.
 */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Validatable</span> <span class="o">{</span>
  <span class="cm">/**
   * Performs validation of the internal state of this Validatable.
   *
   * @throws InternalStateValidationException
   *          if the state of this Validatable was
   *          in an incorrect state (i.e. invalid).
   */</span>
  <span class="kt">void</span> <span class="nf">validateInternalState</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InternalStateValidationException</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Following the definition of a custom <code>InternalStateValidationException</code> extending <code>IllegalStateException</code>, the small
<code>validation-api</code> module is complete:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="cm">/**
 * Exception indicating problems occurred when validating a Validatable instance.
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">InternalStateValidationException</span> <span class="kd">extends</span> <span class="nc">IllegalStateException</span> <span class="o">{</span>
  <span class="cm">/**
   * Constructs an InternalStateValidationException with the specified detail message.
   * A detail message is a String that describes this particular exception.
   *
   * @param message the String that contains a detailed message
   */</span>
  <span class="kd">public</span> <span class="nf">InternalStateValidationException</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming that the <code>rootParentPOM</code> contains common build definitions which should be applied to the <code>validation-api</code>
module, we should remember to assign the <code>rootParentPOM</code> as its parent.</p>
</div>
<div class="paragraph">
<p>In this brief example, we explore no reason to connect the <code>validation-api</code> to a parent - but in real life
configurations such as licensing, coverage, code style, etc. are frequently configured and maintained
only in one POM - the <code>rootParentPOM</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="implement_the_validation_aspect">Implement the validation aspect</h3>
<div class="paragraph">
<p>Now that our tiny validation API is complete, it is time to implement its corresponding aspect. This happens in the
<code>validation-aspect</code> module, which must import the <code>validation-api</code> as a dependency in its POM. It is also important,
that the <code>validation-aspect</code> module assigns its POM parent to <code>rootParentPOM</code>, since we want to use the AspectJ
dependencies managed in the parent. The POM bits of the <code>validation-aspect</code> project are shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="c">&lt;!-- +========================================= --&gt;</span>
<span class="c">&lt;!-- | Define the Parent POM                    --&gt;</span>
<span class="c">&lt;!-- +========================================= --&gt;</span>
<span class="nt">&lt;parent&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>some.group.id<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>rootParentPOM<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.0.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/parent&gt;</span>

<span class="c">&lt;!-- +========================================= --&gt;</span>
<span class="c">&lt;!-- | Dependency (management) settings         --&gt;</span>
<span class="c">&lt;!-- +========================================= --&gt;</span>
<span class="nt">&lt;dependencies&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>some.group.id<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>validation-api<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>aspectjrt<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>

<span class="c">&lt;!-- +========================================= --&gt;</span>
<span class="c">&lt;!-- | Build settings                           --&gt;</span>
<span class="c">&lt;!-- +========================================= --&gt;</span>
<span class="nt">&lt;build&gt;</span>
  <span class="nt">&lt;plugins&gt;</span>
    <span class="nt">&lt;plugin&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>${project.groupId}<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>aspectj-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;complianceLevel&gt;</span>8<span class="nt">&lt;/complianceLevel&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
      <span class="nt">&lt;executions&gt;</span>
        <span class="nt">&lt;execution&gt;</span>
          <span class="nt">&lt;id&gt;</span>compile-with-aspectj<span class="nt">&lt;/id&gt;</span>
          <span class="nt">&lt;goals&gt;</span>
            <span class="nt">&lt;goal&gt;</span>compile<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;goal&gt;</span>test-compile<span class="nt">&lt;/goal&gt;</span>
          <span class="nt">&lt;/goals&gt;</span>
        <span class="nt">&lt;/execution&gt;</span>
      <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>aspectjtools<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>${aspectj.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;/dependencies&gt;</span>
    <span class="nt">&lt;/plugin&gt;</span>
  <span class="nt">&lt;/plugins&gt;</span>
<span class="nt">&lt;/build&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Besides including the correct parent POM and the required dependencies on <code>aspectjrt</code> and <code>validation-api</code>, the
<code>validation-aspect</code> POM must also configure <code>aspectj-maven-plugin</code> to perform AspectJ compilation.</p>
</div>
<div class="paragraph">
<p>Note that <code>aspectjtools</code> should be included as a plugin dependency for <code>aspectj-maven-plugin</code> to ensure that the same
version of AspectJ is used during compilation and runtime.</p>
</div>
<div class="paragraph">
<p>The aspect implementation itself may appear somewhat complex, despite only having a single active method. The crucial
method call is <code>validatable.validateInternalState();</code>, which appears towards the end of method
<code>performValidationAfterCompoundConstructor</code>. This is the place, where this Aspect invokes the method from the validation
API, and therefore lets the object validate its internal state.</p>
</div>
<div class="paragraph">
<p>The other two methods in the aspect are placeholders for two pointcut expressions defining exactly when the advice
should be triggered. In this example, we want to invoke validation after any constructor other than a default
constructor is called.</p>
</div>
<div class="paragraph">
<p>Why would you not want to perform validation after a default constructor is called? Consider the lifecycle for
frameworks which create an object instance by calling the default constructor of a class, followed by populating its
internal state (i.e. its private members) using reflection. Some such frameworks include JAXB and JPA, implying that
validation cannot be performed immediately after a default constructor has been run since the state of the object is
still empty.</p>
</div>
<div class="paragraph">
<p>The aspect is implemented as a standard Java class using AspectJ annotations, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="cm">/**
 * The aspect enforcing validity on a class implementing Validatable (i.e. Entities).
 * This aspect should be fired immediately after a non-default constructor is invoked,
 * and is intended to run as a singleton.
 * &lt;p&gt;
 * Validation should be run only once, and only after the constructor of the ultimate
 * created instance is run (default AspectJ behaviour is to run the Aspect after any
 * constructor within the inheritance hierarchy is executed [i.e. after constructors
 * in superclasses are run, within the constructor of subtypes]).
 */</span>
<span class="nd">@Aspect</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ValidationAspect</span> <span class="o">{</span>
  <span class="c1">// Our log</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">ValidationAspect</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

  <span class="cm">/**
   * Pointcut defining a default constructor within any class.
   */</span>
  <span class="nd">@Pointcut</span><span class="o">(</span><span class="s">"initialization(*.new())"</span><span class="o">)</span>
  <span class="kt">void</span> <span class="nf">anyDefaultConstructor</span><span class="o">()</span> <span class="o">{}</span>

  <span class="cm">/**
   * Defines a Pointcut for any constructor in a class implementing Validatable -
   * except default constructors (i.e. those having no arguments).
   *
   * @param joinPoint    The currently executing joinPoint.
   * @param aValidatable The Validatable instance just created.
   */</span>
  <span class="nd">@Pointcut</span><span class="o">(</span>
    <span class="n">value</span> <span class="o">=</span> <span class="s">"initialization(se.jguru.nazgul.tools.validation.api.Validatable+.new(..)) "</span>
      <span class="o">+</span> <span class="s">"&amp;&amp; this(aValidatable) "</span>
      <span class="o">+</span> <span class="s">"&amp;&amp; !anyDefaultConstructor()"</span><span class="o">,</span> <span class="n">argNames</span> <span class="o">=</span> <span class="s">"joinPoint, aValidatable"</span>
  <span class="o">)</span>
  <span class="kt">void</span> <span class="nf">anyNonDefaultConstructor</span><span class="o">(</span><span class="kd">final</span> <span class="nc">JoinPoint</span> <span class="n">joinPoint</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">Validatable</span> <span class="n">aValidatable</span><span class="o">)</span> <span class="o">{}</span>

  <span class="cm">/**
   * Validation aspect, performing its job after calling any constructor except
   * non-private default ones (having no arguments).
   *
   * @param joinPoint   The currently executing joinPoint.
   * @param validatable The validatable instance just created.
   * @throws InternalStateValidationException if the validation of the validatable failed.
   */</span>
  <span class="nd">@AfterReturning</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"anyNonDefaultConstructor(joinPoint, validatable)"</span><span class="o">,</span> <span class="n">argNames</span> <span class="o">=</span> <span class="s">"joinPoint, validatable"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">performValidationAfterCompoundConstructor</span><span class="o">(</span><span class="kd">final</span> <span class="nc">JoinPoint</span> <span class="n">joinPoint</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">Validatable</span> <span class="n">validatable</span><span class="o">)</span>
    <span class="kd">throws</span> <span class="nc">InternalStateValidationException</span>
  <span class="o">{</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">log</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Validating instance of type ["</span> <span class="o">+</span> <span class="n">validatable</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">joinPoint</span><span class="o">.</span><span class="na">getStaticPart</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"Static part of join point was null for validatable of type: "</span>
                 <span class="o">+</span> <span class="n">validatable</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">IllegalStateException</span><span class="o">());</span>
      <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// Ignore calling validateInternalState when we execute constructors in</span>
    <span class="c1">// any class but the concrete Validatable class.</span>
    <span class="kd">final</span> <span class="nc">ConstructorSignature</span> <span class="n">sig</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ConstructorSignature</span><span class="o">)</span> <span class="n">joinPoint</span><span class="o">.</span><span class="na">getSignature</span><span class="o">();</span>
    <span class="kd">final</span> <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">constructorDefinitionClass</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="na">getConstructor</span><span class="o">().</span><span class="na">getDeclaringClass</span><span class="o">();</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">validatable</span><span class="o">.</span><span class="na">getClass</span><span class="o">()</span> <span class="o">==</span> <span class="n">constructorDefinitionClass</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Now fire the validateInternalState method.</span>
      <span class="n">validatable</span><span class="o">.</span><span class="na">validateInternalState</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">else</span> <span class="o">{</span>
      <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Ignored firing validatable for constructor defined in ["</span>
                  <span class="o">+</span> <span class="n">constructorDefinitionClass</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"] and Validatable of type ["</span>
                  <span class="o">+</span> <span class="n">validatable</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="include_aspects_into_aspectparentpom">Include aspects into <code>aspectParentPOM</code></h3>
<div class="paragraph">
<p>The last piece of the AspectJ plugin puzzle is the inclusion of our validation aspect into the standard build cycle,
which is performed within the <code>aspectParentPOM</code> module. The <code>aspectParentPOM</code> must therefore include a dependency on the
<code>validation-aspect</code> project, and use the <code>rootParentPOM</code> as a parent.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="c">&lt;!-- +========================================= --&gt;</span>
<span class="c">&lt;!-- | Define the Parent POM                    --&gt;</span>
<span class="c">&lt;!-- +========================================= --&gt;</span>
<span class="nt">&lt;parent&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>some.group.id<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>rootParentPOM<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.0.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/parent&gt;</span>

<span class="c">&lt;!-- +========================================= --&gt;</span>
<span class="c">&lt;!-- | Dependency (management) settings         --&gt;</span>
<span class="c">&lt;!-- +========================================= --&gt;</span>
<span class="nt">&lt;dependencyManagement&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>some.group.id<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>validation-aspect<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.0.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/dependencyManagement&gt;</span>

<span class="nt">&lt;dependencies&gt;</span>
  <span class="c">&lt;!-- Include AOP dependencies --&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>some.group.id<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>validation-aspect<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>aspectjrt<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>

<span class="c">&lt;!-- +========================================= --&gt;</span>
<span class="c">&lt;!-- | Build settings                           --&gt;</span>
<span class="c">&lt;!-- +========================================= --&gt;</span>
<span class="nt">&lt;build&gt;</span>
  <span class="nt">&lt;plugins&gt;</span>
    <span class="nt">&lt;plugin&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>${project.groupId}<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>aspectj-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;complianceLevel&gt;</span>8<span class="nt">&lt;/complianceLevel&gt;</span>
        <span class="nt">&lt;aspectDirectory&gt;</span>src/main/aspect<span class="nt">&lt;/aspectDirectory&gt;</span>
        <span class="nt">&lt;testAspectDirectory&gt;</span>src/test/aspect<span class="nt">&lt;/testAspectDirectory&gt;</span>
        <span class="nt">&lt;XaddSerialVersionUID&gt;</span>true<span class="nt">&lt;/XaddSerialVersionUID&gt;</span>
        <span class="nt">&lt;showWeaveInfo&gt;</span>true<span class="nt">&lt;/showWeaveInfo&gt;</span>
        <span class="nt">&lt;aspectLibraries&gt;</span>
          <span class="nt">&lt;aspectLibrary&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>some.group.id<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>validation-aspect<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;/aspectLibrary&gt;</span>
        <span class="nt">&lt;/aspectLibraries&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
      <span class="nt">&lt;executions&gt;</span>
        <span class="nt">&lt;execution&gt;</span>
          <span class="nt">&lt;id&gt;</span>compile-with-aspectj<span class="nt">&lt;/id&gt;</span>
          <span class="nt">&lt;goals&gt;</span>
            <span class="nt">&lt;goal&gt;</span>compile<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;goal&gt;</span>test-compile<span class="nt">&lt;/goal&gt;</span>
          <span class="nt">&lt;/goals&gt;</span>
        <span class="nt">&lt;/execution&gt;</span>
      <span class="nt">&lt;/executions&gt;</span>
      <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
          <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId&gt;</span>aspectjtools<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version&gt;</span>${aspectj.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;/dependencies&gt;</span>
    <span class="nt">&lt;/plugin&gt;</span>
  <span class="nt">&lt;/plugins&gt;</span>
<span class="nt">&lt;/build&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For all modules using the <code>aspectParentPOM</code> as their parent, the validation aspect will be woven into all classes
implementing <code>Validatable</code>. This means, you can perform automatic AspectJ-driven validation in objects inside or outside
any container.</p>
</div>
</div>
</div>
</div>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2018&#x2013;2024
<a href="https://github.com/dev-aspectj">AspectJ.dev</a>
</p>
        </div>
      </div>
    </footer>
<script>
	if(anchors) {
	  anchors.add();
	}
</script>
  </body>
</html>
